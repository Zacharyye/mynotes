# 连接池

> 一般对外提供获得连接、归还连接的接口给客户端使用，并暴露最小空闲连接数、最大连接数等可配置参数，在内部则实现连接建立、连接心跳保持、连接管理、空闲连接回收、连接可用性检测等功能。示意图如下：
>
> ![img](https://static001.geekbang.org/resource/image/16/7e/1685d9db2602e1de8483de171af6fd7e.png)
>
> 常用的连接池：数据库连接池、Redis连接池和HTTP连接池

# 注意鉴别客户端SDK是否基于连接池

> 1.TCP是面向连接的基于字节流的协议：
>
> - 面向连接，意味着连接需要先创建再使用，创建连接的三次握手有一定开销
> - 基于字节流，意味着字节是发送数据的最小单元，TCP协议本身无法区分哪几个字节是完整的消息体，也无法感知是否有多个客户端在使用同一个TCP连接，TCP只是一个个读写数据的管道。
>
> addshutdownhook - JVM关闭之前调用，钩子？
>
> - Runtime.getRuntime().addShutdownHook(...)

# 使用连接池务必确保复用

> 池一定是用来复用的，否则其使用代价会比每次创建单一对象更大。对连接池来说更是如此，原因如下：
>
> - 创建连接池的时候很可能一次性创建了多个连接，大多数连接池考虑到性能，会在初始化的时候维护一定数量的最小连接（毕竟初始化连接池的过程一般是一次性的），可以直接使用。如果每次使用连接池都按需创建连接池，那么很可能只用到一个连接，但是创建了n个连接
> - 连接池一般会有一些管理模块，也就是连接池的结构示意图中的绿色部分。举个例子，大多数的连接池都有闲置超时的概念。连接池会检测连接的限制时间，定期回收闲置的连接，把活跃连接数降到最低（闲置）连接的配置值，减轻服务端的压力。一般情况下，闲置连接由独立线程管理，启动了空闲检测的连接池相当于还会启动一个线程。此外，有些连接池还需要独立线程负责连接保活等功能。因此，启动一个连接池乡单于启动了N个线程。
> - 如果连接池不释放，还可能引起线程泄漏
>
> 待练习 - wireshark



# 连接池的配置不是一成不变的

> 一个事物对应一个TCP连接
>
> 修改后要生效～

